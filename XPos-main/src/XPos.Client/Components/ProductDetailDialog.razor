@using XPos.Shared.DTOs
@using XPos.Client.Services
@using MudBlazor
@inject CartService CartService

<MudDialog Class="product-dialog-wrapper" ContentClass="p-0">
    <DialogContent>
        <div class="pd-container">
            <!-- Image -->
            <div class="pd-image-section">
                @if (!string.IsNullOrEmpty(Product.ImageUrl))
                {
                    <img src="@Product.ImageUrl" class="pd-image" alt="@Product.Name" />
                }
                else
                {
                    <div class="pd-image-placeholder">
                        <MudIcon Icon="@Icons.Material.Filled.Restaurant" Style="font-size: 60px;" />
                    </div>
                }
                <div class="pd-image-gradient"></div>
                <button class="pd-close-btn" @onclick="Cancel">
                    <MudIcon Icon="@Icons.Material.Filled.Close" Size="Size.Small" />
                </button>
                <div class="pd-image-price">₺@Product.Price.ToString("N0")</div>
            </div>

            <!-- Content -->
            <div class="pd-content">
                <h2 class="pd-title">@Product.Name</h2>
                <p class="pd-description">@Product.Description</p>

                <!-- Quantity -->
                <div class="pd-quantity-section">
                    <span class="pd-quantity-label">Adet</span>
                    <div class="pd-quantity-controls">
                        <button class="pd-qty-btn" @onclick="@(() => UpdateQuantity(-1))" disabled="@(quantity <= 1)">
                            <MudIcon Icon="@Icons.Material.Filled.Remove" Size="Size.Small" />
                        </button>
                        <span class="pd-qty-value">@quantity</span>
                        <button class="pd-qty-btn pd-qty-btn-plus" @onclick="@(() => UpdateQuantity(1))">
                            <MudIcon Icon="@Icons.Material.Filled.Add" Size="Size.Small" />
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </DialogContent>
    <DialogActions>
        <div class="pd-footer">
            <button class="pd-add-to-cart" @onclick="Submit">
                <MudIcon Icon="@Icons.Material.Filled.ShoppingBag" Size="Size.Small" />
                <span>Sepete Ekle</span>
                <span class="pd-total-price">₺@((Product.Price * quantity).ToString("N0"))</span>
            </button>
        </div>
    </DialogActions>
</MudDialog>

<style>
    /* Dialog z-index fix */
    .mud-overlay { z-index: 10000 !important; }
    .mud-dialog-container { z-index: 10001 !important; }

    .product-dialog-wrapper {
        border-radius: 20px !important; overflow: hidden;
        max-width: 420px !important; width: 100% !important;
        box-shadow: 0 25px 60px rgba(0,0,0,0.3) !important;
        margin: 16px;
    }

    .pd-container { background: white; }

    /* Image Section */
    .pd-image-section {
        position: relative; width: 100%; aspect-ratio: 16/10; overflow: hidden;
    }
    .pd-image {
        width: 100%; height: 100%; object-fit: cover;
        transition: transform 0.6s ease;
    }
    .pd-image:hover { transform: scale(1.05); }
    .pd-image-placeholder {
        width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
        background: linear-gradient(135deg, #F3F4F6, #E5E7EB); color: #9CA3AF;
    }
    .pd-image-gradient {
        position: absolute; bottom: 0; left: 0; right: 0; height: 50%;
        background: linear-gradient(transparent, rgba(0,0,0,0.4));
        pointer-events: none;
    }
    .pd-close-btn {
        position: absolute; top: 12px; right: 12px;
        width: 36px; height: 36px; border-radius: 50%;
        background: rgba(255,255,255,0.9); backdrop-filter: blur(4px);
        border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        transition: all 0.2s;
    }
    .pd-close-btn:hover { background: white; transform: rotate(90deg); }

    .pd-image-price {
        position: absolute; bottom: 16px; left: 16px;
        background: rgba(255,255,255,0.95); backdrop-filter: blur(8px);
        padding: 8px 18px; border-radius: 24px;
        font-weight: 800; font-size: 1.25rem; color: #FF5500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* Content */
    .pd-content { padding: 20px 20px 8px; }
    .pd-title {
        font-family: 'Outfit', sans-serif; font-size: 1.4rem; font-weight: 800;
        color: #111827; margin: 0 0 8px; letter-spacing: -0.5px;
    }
    .pd-description { font-size: 0.9rem; color: #6B7280; line-height: 1.5; margin: 0 0 20px; }

    /* Quantity */
    .pd-quantity-section {
        display: flex; align-items: center; justify-content: space-between;
        background: #F9FAFB; border-radius: 14px; padding: 12px 16px;
        border: 1px solid #F3F4F6;
    }
    .pd-quantity-label { font-weight: 600; color: #374151; font-size: 0.95rem; }
    .pd-quantity-controls { display: flex; align-items: center; gap: 16px; }
    .pd-qty-btn {
        width: 36px; height: 36px; border-radius: 10px; border: 1.5px solid #E5E7EB;
        background: white; cursor: pointer; display: flex; align-items: center; justify-content: center;
        transition: all 0.2s; color: #374151;
    }
    .pd-qty-btn:hover { border-color: #FF5500; color: #FF5500; }
    .pd-qty-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .pd-qty-btn-plus { background: #FF5500; color: white; border-color: #FF5500; }
    .pd-qty-btn-plus:hover { background: #E64D00; }
    .pd-qty-value { font-size: 1.2rem; font-weight: 800; color: #111827; min-width: 30px; text-align: center; }

    /* Footer */
    .pd-footer { width: 100%; padding: 16px 20px 20px; }
    .pd-add-to-cart {
        width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;
        padding: 14px 20px; border-radius: 14px; border: none;
        background: linear-gradient(135deg, #FF5500, #FF7A33);
        color: white; font-weight: 700; font-size: 1rem; cursor: pointer;
        box-shadow: 0 6px 20px rgba(255,85,0,0.35);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .pd-add-to-cart:hover {
        box-shadow: 0 8px 28px rgba(255,85,0,0.45);
        transform: translateY(-2px);
    }
    .pd-add-to-cart:active { transform: scale(0.97); }
    .pd-total-price {
        background: rgba(255,255,255,0.2); padding: 4px 12px;
        border-radius: 8px; font-weight: 800;
    }
</style>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter] public ProductDto Product { get; set; } = new();

    private int quantity = 1;

    private void UpdateQuantity(int change)
    {
        quantity += change;
        if (quantity < 1) quantity = 1;
    }

    private void Cancel() => MudDialog.Cancel();

    private void Submit()
    {
        for (int i = 0; i < quantity; i++)
        {
            CartService.AddToCart(Product);
        }
        MudDialog.Close(DialogResult.Ok(true));
    }
}
